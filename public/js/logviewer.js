var activeSite="www",socket=null,dirtyFlags={www:!1,bsd:!1},highlightPattern=/(.*\.)(\w+(?:Exception|Error))(.*)/g,displayLog=function(e){var t=e.server,i="<p class='highlight'>"+e.message+"</p>",a=$("#container-"+t),n=a.parent().hasClass("active");if(n){var o=a.parent().parent().parent(),r=o.prop("scrollHeight"),l=o.scrollTop()+o.parent().height()==r;l&&o.animate({scrollTop:r},1e3)}a.append(highlightException(i)),$(".highlight").yellowFade().removeClass("highlight"),updateBadge(t)},updateBadge=function(e){var t=$("#badge-"+e),i=Number(t.text())+1;t.html(i),t.addClass("badge-highlight").delay(500).queue(function(){$(this).removeClass("badge-highlight").dequeue()})},highlightException=function(e){return e.replace(highlightPattern,"$1<span class='label label-primary'>$2</span>$3")},registerMenuEvents=function(){$(".sites > li > a").on("click",function(e){var t=$(e.target);$(".sites > li").removeClass("active"),t.parent().addClass("active");var i=t.data("site");activeSite=i,loadLogContainer(),restartTailLogs()})},registerClearEvent=function(){$("#clearBtn").on("click",function(e){$(".tab-pane.active > pre").empty(),$("#badge-"+$(".tab-pane.active").prop("id")).html(0)})},startTailLogs=function(){socket.on("connect",function(){var e=localStorage.getItem("clientId");null===e&&(e=socket.id,localStorage.setItem("clientId",e)),socket.emit("request",{clientId:e,site:activeSite})}),console.log("sub: "+activeSite),socket.on(activeSite,function(e){displayLog(e),dirtyFlags[activeSite]=!0})},restartTailLogs=function(){socket.disconnect(),socket=io(),startTailLogs()},loadLogContainer=function(){var e=$(".logContainer");e.load("/"+activeSite,function(){registerClearEvent(),resizeLogPanel()})},resizeLogPanel=function(){$(".panel-body").css("height",$(window).height()-138)};$(function(){registerMenuEvents(),loadLogContainer(),socket=io(),startTailLogs(),window.onresize=resizeLogPanel}),function(e){e.fn.yellowFade=function(){return this.animate({backgroundColor:"#ffffcc"},1).animate({backgroundColor:"#F5F5F5"},5e3),this}}(jQuery);